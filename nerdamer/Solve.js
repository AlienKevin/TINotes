if("undefined"!=typeof module){var nerdamer=require("./nerdamer.core.js");require("./Calculus.js"),require("./Algebra.js")}!function(){var e=nerdamer.getCore(),t=e.PARSER,n=e.Algebra,r=e.Calculus,i=r.integration.decompose_arg,o=e.Utils.remove,a=e.Utils.format,s=e.Utils.build,l=e.Symbol,u=e.Utils.isSymbol,c=e.Utils.variables,p=e.groups.S,f=e.groups.PL,v=e.groups.CB,g=e.groups.CP,S=e.groups.FN,m=e.Utils.isArray;function h(t,n){if(n.isConstant()&&t.isConstant()&&!t.equals(n)||t.equals(e.Settings.IMAGINARY)||n.equals(e.Settings.IMAGINARY))throw new e.exceptions.NerdamerValueError(t.toString()+" does not equal "+n.toString());this.LHS=t,this.RHS=n}e.Solve={version:"1.2.6",solve:function(t,n){var r=H(t,String(n));return new e.Vector(r)}},e.Settings.SOLVE_RADIUS=1e3,e.Settings.ROOTS_PER_SIDE=5,e.Settings.make_pi_conversions=!0,e.Settings.STEP_SIZE=.1,e.Symbol.prototype.hasTrig=function(){return this.containsFunction(["cos","sin","tan","cot","csc","sec"])},e.Symbol.prototype.hasNegativeTerms=function(){if(this.isComposite())for(var e in this.symbols){var t=this.symbols[e];if(t.group===f&&t.hasNegativeTerms()||this.symbols[e].power.lessThan(0))return!0}return!1};var b=function(e,n){if(n.group===g&&n.group!==g){var r=e;e=n,n=r}if(e.group===v){r=new l(e.multiplier);var i=n.clone();e.each(function(e){e.power.lessThan(0)?i=t.divide(i,e):r=t.multiply(r,e)}),e=r,n=i}else if(e.group===g)for(var o in e.symbols){var a=e.symbols[o];if(a.group===v)for(var s in a.symbols){var u=a.symbols[s];if(u.power.lessThan(0))return b(t.expand(t.multiply(u.clone().toLinear(),e)),t.expand(t.multiply(u.clone().toLinear(),n)))}}return t.expand(t.subtract(e,n))};h.prototype={toString:function(){return this.LHS.toString()+"="+this.RHS.toString()},text:function(e){return this.LHS.text(e)+"="+this.RHS.text(e)},toLHS:function(){return b(this.LHS.clone(),this.RHS.clone())},clone:function(){return new h(this.LHS.clone(),this.RHS.clone())},sub:function(e,t){var n=this.clone();return n.LHS=n.LHS.sub(e.clone(),t.clone()),n.RHS=n.RHS.sub(e.clone(),t.clone()),n},isZero:function(){return e.Utils.evaluate(this.toLHS()).equals(0)},latex:function(e){return[this.LHS.latex(e),this.RHS.latex(e)].join("=")}},t.equals=function(e,t){return new h(e,t)};var d=function(e){if(e instanceof h)return e.toLHS();var n=e.split("=");void 0===n[1]&&(n[1]="0");var r=t.parse(n[0]),i=t.parse(n[1]);return b(r,i)},y=e.Utils.checkAll=function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return!1;return!0},w=function(e,n,r,i){var o="-"===i?"subtract":"add",a=t.subtract(t.pow(n.clone(),l(2)),t.multiply(t.multiply(r.clone(),e.clone()),l(4))),s=t.pow(a,l(.5));return t.divide(t[o](n.clone().negate(),s),t.multiply(new l(2),r.clone()))},U=function(n,r,i,o){var s=o.text(),l=i.text(),u=r.text(),p=n.text(),f=t.parse(a("({1})^2-3*({0})*({2})",s,l,u)),v=t.parse(a("((2*({1})^3-9*({0})*({1})*({2})+27*({0})^2*({3}))^2-4*(({1})^2-3*({0})*({2}))^3)^(1/2)",s,l,u,p)),g=t.parse(a("((1/2)*(({4})+2*({1})^3-9*({0})*({1})*({2})+27*({0})^2*({3})))^(1/3)",s,l,u,p,v)),S={};c(g).map(function(e){S[e]=1});var m=e.Utils.block("PARSE2NUMBER",function(){return t.parse(g,S)});return 0===Number(f)&&0===Number(m)&&(g=t.parse(a("((1/2)*(-({4})+2*({1})^3-9*({0})*({1})*({2})+27*({0})^2*({3})))^(1/3)",s,l,u,p,v))),["-(b/(3*a))-C/(3*a)-(((b^2-3*a*c))/(3*a*C))","-(b/(3*a))+(C*(1+i*sqrt(3)))/(6*a)+((1-i*sqrt(3))*(b^2-3*a*c))/(6*a*C)".replace(/i/g,e.Settings.IMAGINARY),"-(b/(3*a))+(C*(1-i*sqrt(3)))/(6*a)+((1+i*sqrt(3))*(b^2-3*a*c))/(6*a*C)".replace(/i/g,e.Settings.IMAGINARY)].map(function(e,a){var s={a:o.clone(),b:i.clone(),c:r.clone(),d:n.clone(),C:g.clone()};return t.parse(e,s)})},x=function(t,n){n=n||.1;var r=s(t),i=Math.round(r(0)),o=r(i),a=o/Math.abs(o),l=[],u=e.Settings.ROOTS_PER_SIDE,c=2*u+1;l.push(Math.floor(i/2)),t.each(function(e){e.containsFunction("log")&&l.push(.1)});for(var p=i;p<e.Settings.SOLVE_RADIUS;p++){var f=(v=r(p*n))/Math.abs(v);if(isNaN(v)||!isFinite(v)||l.length>u)break;f!==a&&l.push((p-1)/2),a=f}for(p=i-1;p>-e.Settings.SOLVE_RADIUS;p--){var v;f=(v=r(p))/Math.abs(v);if(isNaN(v)||!isFinite(v)||l.length>c)break;f!==a&&l.push((p-1)/2),a=f}return l},R=function(e,t,n){var r,i=0,o=e;do{var a=t(o);if(0===o&&0===a){r=0;break}if(++i>200)return;r=o-a/n(o);var s=Math.abs(r-o);o=r}while(s>Number.EPSILON);return r},H=function(b,q,L){if(b instanceof h){if(b.isZero())return[new l(0)];if(b.LHS.equals(q)&&!b.RHS.contains(q))return[b.RHS];if(b.RHS.equals(q)&&!b.LHS.contains(q))return[b.LHS]}if(b instanceof e.Vector&&(b=b.elements),q=q||"x",m(b))return function(r,a){for(var s=0;s<r.length;s++)r[s]=d(r[s]);var u,p=r.length,f=new e.Matrix,v=new e.Matrix,g=!1;if(void 0===a){for(n.allLinear(r)||e.err("System must contain all linear equations!"),u=c(r[0]),s=1;s<p;s++)u=u.concat(c(r[s]));for(u=e.Utils.arrayUnique(u).sort(),s=0;s<u.length;s++)nerdamer.setVar(u[s],"delete");for(s=0;s<p;s++){for(var S=r[s],m=0;m<p;m++){var h=S.symbols[u[m]];f.set(s,m,h?h.multiplier:0)}var b=S.symbols["#"];v.set(s,0,new l(b?-b.multiplier:0))}}else for(u=a,g=!0,s=0;s<p;s++){for(v.set(s,0,new l(0)),S=t.expand(r[s]).collectSymbols(),m=0;m<a.length;m++){f.set(s,m,new l(0));for(var y=a[m],w=0;w<S.length;w++){for(var U=S[w],x=!1,R=0;R<a.length;R++)U.contains(a[R])&&(x&&e.err("Multiple variables found for term "+U),x=!0);if(U.contains(y)){var H=i(o(S,w),y);f.set(s,m,t.add(f.get(s,m),H[0]))}}}for(w=0;w<S.length;w++)v.set(s,0,t.add(v.get(s,0),S[w]))}var q=(f=f.invert()).multiply(v);e.Utils.isArray(a)&&q.each(function(e){return e.negate()});var L=e.Settings.SOLUTIONS_AS_OBJECT?{}:[];return q.each(function(n,r){var i=(g?t.expand(n):n).valueOf(),o=u[r];e.Settings.SOLUTIONS_AS_OBJECT?L[o]=i:L.push([o,i])}),L}.apply(void 0,arguments);if(L=L||[],b.group===p&&b.contains(q))return L.push(new l(0)),L;if(b.group===v){var E=String(q);return b.each(function(e){e.contains(E)&&H(e,q,L)}),L}var A={},N=function(n,r){var i=u(n);if(!(void 0===n||"number"==typeof n&&isNaN(n)))if(m(n))L=L.concat(n);else if("null"!==n.valueOf()){if(i||(n=t.parse(n)),e.Settings.make_pi_conversions&&r){var o=t.divide(n.clone(),new l(Math.PI)),a=o.multiplier,s=Math.abs(a.num),c=Math.abs(a.den);s<10&&c<10&&(n=t.multiply(o,new l("pi")))}var p=n.toString();A[p]||L.push(n),A[p]=!0}},I=e.Utils.isSymbol(b)?b:d(b),M=e.Utils.variables(I),C=M.length;if(I.group===p||I.group===v&&I.contains(q))return[new l(0)];var _,T={},O=function(n){var r=n.clone();if(n.symbols)for(var o in n.symbols){var a=n.symbols[o],s=i(a,q),c=s[1].fname===e.Settings.SQRT,p=l.unwrapSQRT(s[1]),v=p.power.clone();if(!u(v)&&!v.equals(.5))if(v.den.gt(1)){if(c)return n=t.subtract(n,a.clone()),n=t.add(n,t.multiply(s[0].clone(),p)),O(n);var g=T[v.den];T[v.den]=g?g++:1}else{if(-1===v.sign()){var S=t.parse(q+"^"+Math.abs(v));return n.each(function(e,r){e.contains(q)&&(n.symbols[r]=t.multiply(e,S.clone()))}),T={},O(t.parse(n))}if(a.group===f){var m=e.Utils.arrayMin(e.Utils.keys(a.symbols));if(m<0){S=t.parse(q+"^"+Math.abs(m));var h=new l(0);return r.each(function(e){h=t.add(h,t.multiply(e.clone(),S.clone()))},!0),h}}}}return n},k=function(n,r){r=r||new l(0);var i=0,o=(n=l.unwrapSQRT(t.expand(n))).length;if(n.group===g&&n.contains(q)&&n.isLinear()){n.distributeMultiplier();var a=new l(0);return n.each(function(e){e.contains(q)?(i++,a=t.add(a,e.clone())):r=t.subtract(r,e.clone())}),n=a,i!==o?k(n,r):[n,r]}if(n.group===v&&n.contains(q)&&n.isLinear()){if(n.multiplier.lessThan(0)&&(n.multiplier=n.multiplier.multiply(new e.Frac(-1)),r.multiplier=r.multiplier.multiply(new e.Frac(-1))),r.equals(0))return new l(0);a=new l(1);return n.each(function(e){e.contains(q)?a=t.multiply(a,e.clone()):r=t.divide(r,e.clone())}),k(n=a,r)}if(!n.isLinear()&&n.contains(q)){var s=t.parse(n.power.clone().invert());return n=t.pow(n,s.clone()),r=t.pow(t.expand(r),s.clone()),k(n,r)}if(n.group===S||n.group===p||n.group===f)return[n,r]},F=function(e){var n=new l(0),r=new l(0);return e.each(function(e){e.contains(q,!0)?n=t.add(n,e.clone()):r=t.subtract(r,e.clone())}),[n,r]};if((I=O(I)).equals(0))return[I];var P=e.Utils.keys(T);if(1===P.length&&(_=P[0],I.each(function(n,r){if(n.contains(q)){var o=i(n,q),a=o[1],s=a.power;s.den.gt(1)&&(a.power=s.multiply(new e.Frac(_)),I.symbols[r]=t.multiply(a,o[0]))}}),I=t.parse(I)),1===C)if(I.isPoly(!0)){var V=(Y=e.Utils.getCoeffs(I,q)).length-1,G=!1;if(M[0]===q){if(y(Y,function(t){return t.group!==e.groups.N})){var D=e.Algebra.proots(I);y(D,function(t){return!e.Utils.isInt(t)})&&(G=!0,D.map(function(e){N(new l(e))}))}G||(1===V?N(t.divide(Y[0],Y[1].negate())):2===V?(N(t.expand(w.apply(void 0,Y))),Y.push("-"),N(t.expand(w.apply(void 0,Y)))):3===V?N(U.apply(void 0,Y)):n.proots(I).map(N))}}else!function(t){for(var n=t.hasTrig(),i=x(t,.1),o=x(t,.05),a=x(t,.01),l=e.Utils.arrayUnique(i.concat(o).concat(a)),u=l.length,c=s(t.clone()),p=s(r.diff(t.clone())),f=0;f<u;f++){var v=l[f];N(R(v,c,p),n)}L.sort()}(I);else if(!I.hasFunc(q)&&I.isComposite())try{var Y;switch(V=(Y=e.Utils.getCoeffs(I,q)).length-1){case 0:var j=(Z=F(I))[0],B=Z[1];j.group===e.groups.EX&&N(t.parse(e.Utils.format("log(({0})/({2}))/log({1})",B,j.value,j.multiplier)));break;case 1:N(t.divide(Y[0],Y[1].negate()));break;case 2:N(w.apply(void 0,Y)),Y.push("-"),N(w.apply(void 0,Y));break;case 3:N(U.apply(void 0,Y));break;case 4:N(function(n,r,i,o,s){var l,u,f,v,g,S={};return e.Utils.arrayUnique(c(s).concat(c(o)).concat(c(i)).concat(c(r)).concat(c(n))).map(function(e){S[e]=1}),s=s.toString(),o=o.toString(),i=i.toString(),r=r.toString(),n=n.toString(),l=t.parse(a("(8*({0})*({2})-3*({1})^2)/(8*({0})^2)",s,o,i)).toString(),u=t.parse(a("(({1})^3-4*({0})*({1})*({2})+8*({0})^2*({3}))/(8*({0})^3)",s,o,i,r)).toString(),f=t.parse(a("12*({0})*({4})-3*({1})*({3})+({2})^2",s,o,i,r,n)).toString(),v=t.parse(a("2*({2})^3-9*({1})*({2})*({3})+27*({1})^2*({4})+27*({0})*({3})^2-72*({0})*({2})*({4})",s,o,i,r,n)).toString(),g=t.parse(a("((({1})+(({1})^2-4*({0})^3)^(1/2))/2)^(1/3)",f,v)).toString(),p=t.parse(a("(1/2)*(-(2/3)*({1})+(1/(3*({0}))*(({2})+(({3})/({2})))))^(1/2)",s,l,g,f)).toString(),[t.parse(a("-(({1})/(4*({0})))-({4})+(1/2)*sqrt(-4*({4})^2-2*({2})+(({3})/({4})))",s,o,l,u,p)),t.parse(a("-(({1})/(4*({0})))-({4})-(1/2)*sqrt(-4*({4})^2-2*({2})+(({3})/({4})))",s,o,l,u,p)),t.parse(a("-(({1})/(4*({0})))+({4})+(1/2)*sqrt(-4*({4})^2-2*({2})-(({3})/({4})))",s,o,l,u,p)),t.parse(a("-(({1})/(4*({0})))+({4})-(1/2)*sqrt(-4*({4})^2-2*({2})-(({3})/({4})))",s,o,l,u,p))]}.apply(void 0,Y));break;default:N(function(n,r){return e.Utils.block("IGNORE_E",function(){var i,o,s,u,c,f,v,g;if(g=[],(i=e.Utils.decompose_fn(n,r,!0)).x.group===p){var S,m;o=t.parse(i.x.power),s=Number(o),u=t.pow(t.divide(i.b.negate(),i.a),o.invert()),f=(c=l.toPolarFormArray(u))[0],c[1],v=f.toString(),o.toString();for(var h=0;h<s;h++)m=a("({0})*e^(2*{1}*pi*{2}*{3})",v,h,o,e.Settings.IMAGINARY),S=t.parse(m),g.push(S)}return g},!0)}(I,q)),0===L.length&&N(function(t,n){var r=[],i=e.Algebra.Factor.factor(t);return i.group===v&&i.each(function(e){e=l.unwrapPARENS(e),r=r.concat(H(e,n))}),r}(I,q))}}catch(e){}else try{var Q=k(I);j=Q[0],B=Q[1];j.group===S&&("abs"===j.fname?(L.push(B.clone()),L.push(B.negate())):L.push(t.subtract(j,B)))}catch(n){try{if(I.group===v)L.push(0);else if(I.group===g){var Z;j=(Z=F(I))[0],B=Z[1];if(j.group===e.groups.EX&&j.value===q){var J=j.power.clone().invert();L.push(t.pow(B,J))}}}catch(e){}}return _&&(L=L.map(function(e){return t.pow(e,new l(_))})),L};e.Expression.prototype.solveFor=function(t){return H(e.Utils.isSymbol(this.symbol)?this.symbol:this.symbol.toLHS(),t).map(function(t){return new e.Expression(t)})},e.Expression.prototype.expand=function(){if(this.symbol instanceof h){var n=this.symbol.clone();return n.RHS=t.expand(n.RHS),n.LHS=t.expand(n.LHS),new e.Expression(n)}return new e.Expression(t.expand(this.symbol))},e.Expression.prototype.variables=function(){return this.symbol instanceof h?e.Utils.arrayUnique(c(this.symbol.LHS).concat(c(this.symbol.RHS))):c(this.symbol)};var q=function(e,n){return t.equals(e,n)};e.Equation=h,nerdamer.register([{name:"solveEquations",parent:"nerdamer",numargs:-1,visible:!0,build:function(){return H}},{name:"solve",parent:"Solve",numargs:2,visible:!0,build:function(){return e.Solve.solve}},{name:"setEquation",parent:"Solve",visible:!0,build:function(){return q}}]),nerdamer.api()}();